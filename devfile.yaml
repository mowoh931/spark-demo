schemaVersion: 2.2.0
metadata:
  name: spark-demo
  version: 1.0.0
  description: Devfile for deploying Spark Demo application on OpenShift
components:
  - name: spark-demo-image
    image:
      imageName: mowoh931/spark-demo:latest
      dockerfile:
        uri: Dockerfile
  - name: spark-demo
    container:
      image: mowoh/spark-demo:latest
      env:
        - name: JAVA_HOME
          value: /usr/lib/jvm/java-11-openjdk
      mountSources: true
      endpoints:
        - name: web
          targetPort: 8080
  - name: kubernetes-deploy
    kubernetes:
      inlined: |
        apiVersion: apps/v1
        kind: Deployment
        metadata:
          name: spark-demo
        spec:
          replicas: 1
          selector:
            matchLabels:
              app: spark-demo
          template:
            metadata:
              labels:
                app: spark-demo
            spec:
              containers:
                - name: spark-demo
                  image: mowoh/spark-demo:latest
                  ports:
                    - containerPort: 8080
        ---
        apiVersion: v1
        kind: Service
        metadata:
          name: spark-demo-service
        spec:
          selector:
            app: spark-demo
          ports:
            - protocol: TCP
              port: 8080
              targetPort: 8080
        ---
        apiVersion: route.openshift.io/v1
        kind: Route
        metadata:
          name: spark-demo-route
        spec:
          to:
            kind: Service
            name: spark-demo-service
          port:
            targetPort: 8080
commands:
  - id: build-image
    apply:
      component: spark-demo-image
