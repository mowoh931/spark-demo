schemaVersion: 2.2.0
metadata:
  name: spring-boot-gradle-app
  version: 1.0.0
  description: Devfile for a Spring Boot application with Gradle and multi-stage Docker build

components:
  - name: tools-container
    container:
      image: gradle:8.9.0-jdk17-alpine
      memoryLimit: 2Gi
      cpuLimit: 1000m
      mountSources: true
      command: ["sleep"]
      args: ["infinity"]
      endpoints:
        - name: http
          targetPort: 8080

  - name: app-image
    image:
      imageName: spring-boot-gradle-app:latest
      dockerfile:
        uri: Dockerfile
        buildContext: .
        rootRequired: false

commands:
  - id: build
    exec:
      label: "Build the application"
      component: tools-container
      workingDir: /projects
      commandLine: "gradle build --no-daemon"

  - id: run
    exec:
      label: "Run the application"
      component: tools-container
      workingDir: /projects
      commandLine: "java -jar build/libs/*.jar"
      group:
        kind: run
        isDefault: true

  - id: build-image
    build:
      label: "Build the Docker image"
      component: app-image
      commandLine: "docker build -t spring-boot-gradle-app:latest ."
      group:
        kind: build
        isDefault: true

projects:
  - name: spark-demo
    git:
      remotes:
        origin: "https://github.com/mowoh931/spark-demo.git"

deploy:
  kubernetes:
    manifests:
      - path: deploy/k8s
  openshift:
    manifests:
      - path: deploy/openshift